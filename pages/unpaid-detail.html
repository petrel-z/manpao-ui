<!-- 待支付详情 -->
<div class="page" id="unpaid-detail">
    <div class="min-h-full bg-gray-50 relative">
        <!-- 头部导航 -->
        <div class="bg-white p-3 flex items-center justify-between sticky top-0 z-10 shadow-sm">
            <i class="fas fa-arrow-left text-gray-600 text-lg cursor-pointer" onclick="showPage('orders')"></i>
            <h1 class="font-semibold text-body-lg">待支付订单</h1>
            <i class="fas fa-times text-gray-600 text-lg cursor-pointer" onclick="cancelOrder()"></i>
        </div>

        <div class="max-h-[50vh] overflow-y-auto custom-scrollbar">
            <!-- 支付倒计时 -->
            <div class="bg-gradient-to-r from-orange-500 to-red-500 mx-3 mt-3 rounded-lg p-4 text-white">
                <div class="flex items-center justify-between">
                    <div class="flex items-center">
                        <i class="fas fa-clock text-2xl mr-3"></i>
                        <div>
                            <h3 class="font-bold text-lg">等待支付</h3>
                            <p class="text-orange-100 text-caption">请在规定时间内完成支付</p>
                        </div>
                    </div>
                    <div class="text-right">
                        <p class="text-orange-100 text-caption">剩余时间</p>
                        <div class="flex items-center space-x-1">
                            <span id="countdown-minutes" class="bg-white bg-opacity-20 px-2 py-1 rounded text-lg font-bold">14</span>
                            <span class="text-sm">:</span>
                            <span id="countdown-seconds" class="bg-white bg-opacity-20 px-2 py-1 rounded text-lg font-bold">59</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 订单信息 -->
            <div class="bg-white mx-3 mt-3 rounded-lg p-3 shadow-sm">
                <div class="flex items-center justify-between mb-3">
                    <h3 class="font-semibold text-body-md flex items-center">
                        <i class="fas fa-receipt text-red-500 mr-2"></i>
                        订单信息
                    </h3>
                    <span class="text-orange-500 text-caption font-medium bg-orange-50 px-2 py-1 rounded">待支付</span>
                </div>
                <div class="space-y-2 text-caption">
                    <div class="flex justify-between">
                        <span class="text-gray-600">订单号</span>
                        <div class="flex items-center">
                            <span class="text-gray-800 font-mono mr-2">#202312150002</span>
                            <i class="fas fa-copy text-gray-400 cursor-pointer" onclick="copyOrderNumber()"></i>
                        </div>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-600">下单时间</span>
                        <span class="text-gray-800">2023-12-15 15:30</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-600">预计送达</span>
                        <span class="text-gray-800">16:00-16:30</span>
                    </div>
                </div>
            </div>

            <!-- 商家信息 -->
            <div class="bg-white mx-3 mt-3 rounded-lg overflow-hidden shadow-sm">
                <div class="p-3 border-b border-gray-100">
                    <h3 class="font-semibold text-body-md mb-3 flex items-center">
                        <i class="fas fa-store text-red-500 mr-2"></i>
                        商家信息
                    </h3>
                    <div class="flex items-center space-x-3">
                        <img src="https://images.unsplash.com/photo-1571091718767-18b5b1457add?w=60&h=60&fit=crop" 
                             alt="麦当劳" class="w-12 h-12 rounded-lg object-cover">
                        <div class="flex-1">
                            <h4 class="font-semibold text-body-md">麦当劳（北大店）</h4>
                            <p class="text-gray-600 text-caption">距离1.5km · 营业中</p>
                            <div class="flex items-center mt-1">
                                <span class="text-orange-500 font-bold text-caption mr-2">★ 4.8</span>
                                <span class="text-gray-500 text-caption">月售1000+</span>
                            </div>
                        </div>
                        <button class="border border-gray-300 text-gray-700 px-3 py-1 rounded text-caption" onclick="callMerchant()">
                            <i class="fas fa-phone mr-1"></i>联系商家
                        </button>
                    </div>
                </div>
            </div>

            <!-- 商品信息 -->
            <div class="bg-white mx-3 mt-3 rounded-lg p-3 shadow-sm">
                <h3 class="font-semibold text-body-md mb-3 flex items-center">
                    <i class="fas fa-shopping-bag text-red-500 mr-2"></i>
                    商品信息
                </h3>
                
                <!-- 商品1 -->
                <div class="flex items-center space-x-3 mb-3 p-2 bg-gray-50 rounded-lg">
                    <img src="https://images.unsplash.com/photo-1568901346375-23c9450c58cd?w=60&h=60&fit=crop" 
                         alt="巨无霸" class="w-12 h-12 rounded-lg object-cover">
                    <div class="flex-1">
                        <h6 class="font-medium text-body-sm">巨无霸</h6>
                        <p class="text-gray-500 text-caption">经典牛肉汉堡</p>
                        <div class="flex items-center justify-between mt-1">
                            <div class="flex items-center space-x-2">
                                <span class="text-red-500 font-bold text-caption">￥22</span>
                                <span class="text-gray-400 text-caption line-through">￥25</span>
                            </div>
                            <span class="text-gray-600 text-caption">×2</span>
                        </div>
                    </div>
                </div>
                
                <!-- 商品2 -->
                <div class="flex items-center space-x-3 mb-3 p-2 bg-gray-50 rounded-lg">
                    <img src="https://images.unsplash.com/photo-1594212699903-ec8a3eca50f5?w=60&h=60&fit=crop" 
                         alt="薯条" class="w-12 h-12 rounded-lg object-cover">
                    <div class="flex-1">
                        <h6 class="font-medium text-body-sm">中薯条</h6>
                        <p class="text-gray-500 text-caption">香脆可口</p>
                        <div class="flex items-center justify-between mt-1">
                            <span class="text-red-500 font-bold text-caption">￥12</span>
                            <span class="text-gray-600 text-caption">×1</span>
                        </div>
                    </div>
                </div>
                
                <!-- 商品3 -->
                <div class="flex items-center space-x-3 p-2 bg-gray-50 rounded-lg">
                    <img src="https://images.unsplash.com/photo-1461023058943-07fcbe16d735?w=60&h=60&fit=crop" 
                         alt="可乐" class="w-12 h-12 rounded-lg object-cover">
                    <div class="flex-1">
                        <h6 class="font-medium text-body-sm">可口可乐</h6>
                        <p class="text-gray-500 text-caption">中杯</p>
                        <div class="flex items-center justify-between mt-1">
                            <span class="text-red-500 font-bold text-caption">￥8</span>
                            <span class="text-gray-600 text-caption">×1</span>
                        </div>
                    </div>
                </div>
            </div>


            <!-- 费用明细 -->
            <div class="bg-white mx-3 mt-3 rounded-lg p-3 shadow-sm">
                <h3 class="font-semibold text-body-md mb-3 flex items-center">
                    <i class="fas fa-calculator text-red-500 mr-2"></i>
                    费用明细
                </h3>
                <div class="space-y-2 text-caption">
                    <div class="flex justify-between">
                        <span class="text-gray-600">商品小计</span>
                        <span class="text-gray-800">￥64</span>
                    </div>
                    <div class="flex justify-between text-red-500">
                        <span>优惠券</span>
                        <span>-￥5</span>
                    </div>
                    <div class="border-t border-gray-200 pt-2 mt-2">
                        <div class="flex justify-between font-semibold text-body-sm">
                            <span class="text-gray-800">应付金额</span>
                            <span class="text-red-500 text-lg">￥64</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 支付方式 -->
            <div class="bg-white mx-3 mt-3 rounded-lg p-3 shadow-sm">
                <h3 class="font-semibold text-body-md mb-3 flex items-center">
                    <i class="fas fa-credit-card text-red-500 mr-2"></i>
                    支付方式
                </h3>
                <div class="space-y-3">
                    <!-- 微信支付 -->
                    <div class="flex items-center justify-between p-3 border border-green-200 rounded-lg bg-green-50 cursor-pointer" 
                         onclick="selectPayment('wechat')" id="wechat-payment">
                        <div class="flex items-center space-x-3">
                            <div class="w-8 h-8 bg-green-500 rounded-full flex items-center justify-center">
                                <i class="fab fa-weixin text-white"></i>
                            </div>
                            <div>
                                <p class="font-medium text-body-sm">微信支付</p>
                                <p class="text-gray-500 text-caption">推荐使用</p>
                            </div>
                        </div>
                        <div class="w-5 h-5 border-2 border-green-500 rounded-full flex items-center justify-center">
                            <div class="w-3 h-3 bg-green-500 rounded-full"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 底部支付区域 -->
        <div class=" bottom-0 bg-white border-t border-gray-200 p-3 shadow-lg mt-4">
            <div class="flex items-center justify-between mb-3">
                <div class="flex items-center space-x-2">
                    <span class="text-gray-600 text-caption">应付金额：</span>
                    <span class="text-red-500 font-bold text-xl">￥64</span>
                </div>
                <div class="flex items-center space-x-2 text-caption text-gray-500">
                    <i class="fas fa-shield-alt text-green-500"></i>
                    <span>安全支付</span>
                </div>
            </div>
            <div class="flex space-x-3">
                <button class="flex-1 border border-gray-300 text-gray-700 py-3 rounded-lg font-medium text-body-sm" 
                        onclick="cancelOrder()">
                    <i class="fas fa-times mr-2"></i>取消订单
                </button>
                <button class="flex-2 bg-red-500 text-white py-3 rounded-lg font-medium text-body-sm" 
                        onclick="proceedPayment()" style="flex: 2;">
                    <i class="fas fa-credit-card mr-2"></i>立即支付
                </button>
            </div>
        </div>

        <!-- 支付确认模态框 -->
        <div id="payment-modal" class="absolute inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center">
            <div class="bg-white rounded-lg w-80 p-6 mx-4">
                <div class="text-center mb-4">
                    <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-3">
                        <i class="fas fa-credit-card text-green-500 text-2xl"></i>
                    </div>
                    <h3 class="font-bold text-lg mb-2">确认支付</h3>
                    <p class="text-gray-600 text-caption mb-4">请确认支付信息</p>
                    <div class="bg-gray-50 rounded-lg p-3 mb-4">
                        <div class="flex justify-between items-center">
                            <span class="text-gray-600">支付金额</span>
                            <span class="text-red-500 font-bold text-lg">￥64</span>
                        </div>
                    </div>
                </div>
                <div class="flex space-x-3">
                    <button class="flex-1 border border-gray-300 text-gray-700 py-2 rounded-lg" 
                            onclick="hidePaymentModal()">
                        取消
                    </button>
                    <button class="flex-1 bg-red-500 text-white py-2 rounded-lg" 
                            onclick="confirmPayment()">
                        确认支付
                    </button>
                </div>
            </div>
        </div>

        <!-- 取消订单模态框 -->
        <div id="cancel-modal" class="absolute inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center">
            <div class="bg-white rounded-lg w-80 p-6 mx-4">
                <div class="text-center mb-4">
                    <div class="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-3">
                        <i class="fas fa-exclamation-triangle text-red-500 text-2xl"></i>
                    </div>
                    <h3 class="font-bold text-lg mb-2">取消订单</h3>
                    <p class="text-gray-600 text-caption mb-4">确定要取消这个订单吗？取消后无法恢复</p>
                </div>
                <div class="flex space-x-3">
                    <button class="flex-1 border border-gray-300 text-gray-700 py-2 rounded-lg" 
                            onclick="hideCancelModal()">
                        继续支付
                    </button>
                    <button class="flex-1 bg-red-500 text-white py-2 rounded-lg" 
                            onclick="confirmCancel()">
                        确认取消
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.font-mono {
    font-family: 'Courier New', monospace;
}

.line-through {
    text-decoration: line-through;
}

/* 支付方式选中状态 */
.payment-selected {
    border-color: #10b981 !important;
    background-color: #ecfdf5 !important;
}

.payment-selected .payment-radio {
    border-color: #10b981 !important;
}

.payment-selected .payment-radio-dot {
    background-color: #10b981 !important;
}

/* 倒计时动画 */
@keyframes countdown-pulse {
    0%, 100% {
        transform: scale(1);
    }
    50% {
        transform: scale(1.05);
    }
}

.countdown-urgent {
    animation: countdown-pulse 1s ease-in-out infinite;
    background-color: rgba(239, 68, 68, 0.2) !important;
}

/* 按钮点击效果 */
.btn-active:active {
    transform: scale(0.95);
    transition: transform 0.1s ease;
}
</style>

<script>
let countdownTimer;
let selectedPayment = 'wechat';

// 支付倒计时
function startCountdown() {
    let totalSeconds = 15 * 60; // 15分钟
    
    countdownTimer = setInterval(() => {
        const minutes = Math.floor(totalSeconds / 60);
        const seconds = totalSeconds % 60;
        
        document.getElementById('countdown-minutes').textContent = minutes.toString().padStart(2, '0');
        document.getElementById('countdown-seconds').textContent = seconds.toString().padStart(2, '0');
        
        // 最后1分钟添加紧急样式
        if (totalSeconds <= 60) {
            document.getElementById('countdown-minutes').classList.add('countdown-urgent');
            document.getElementById('countdown-seconds').classList.add('countdown-urgent');
        }
        
        if (totalSeconds <= 0) {
            clearInterval(countdownTimer);
            alert('支付超时，订单已取消');
            showPage('orders');
            return;
        }
        
        totalSeconds--;
    }, 1000);
}

// 选择支付方式
function selectPayment(type) {
    // 清除所有选中状态
    document.querySelectorAll('[id$="-payment"]').forEach(el => {
        el.classList.remove('payment-selected');
        el.classList.add('border-gray-200');
        const radio = el.querySelector('.w-5.h-5');
        radio.classList.remove('border-green-500');
        radio.classList.add('border-gray-300');
        const dot = radio.querySelector('div');
        if (dot) dot.remove();
    });
    
    // 设置选中状态
    const selected = document.getElementById(type + '-payment');
    selected.classList.add('payment-selected');
    selected.classList.remove('border-gray-200');
    const radio = selected.querySelector('.w-5.h-5');
    radio.classList.add('border-green-500');
    radio.classList.remove('border-gray-300');
    radio.innerHTML = '<div class="w-3 h-3 bg-green-500 rounded-full"></div>';
    
    selectedPayment = type;
}

// 复制订单号
function copyOrderNumber() {
    const orderNumber = '#202312150002';
    navigator.clipboard.writeText(orderNumber).then(() => {
        alert('订单号已复制到剪贴板');
    }).catch(() => {
        alert('复制失败，请手动复制');
    });
}

// 联系商家
function callMerchant() {
    alert('正在拨打商家电话：010-12345678');
}

// 进行支付
function proceedPayment() {
    const modal = document.getElementById('payment-modal');
    if (modal) {
        modal.classList.remove('hidden');
        modal.classList.add('flex');
    }
}

// 隐藏支付模态框
function hidePaymentModal() {
    const modal = document.getElementById('payment-modal');
    if (modal) {
        modal.classList.add('hidden');
        modal.classList.remove('flex');
    }
}

// 确认支付
function confirmPayment() {
    hidePaymentModal();
    
    // 模拟支付过程
    const loadingAlert = alert('正在处理支付...');
    
    setTimeout(() => {
        clearInterval(countdownTimer);
        alert('支付成功！');
        showPage('order-detail');
    }, 2000);
}

// 取消订单
function cancelOrder() {
    const modal = document.getElementById('cancel-modal');
    if (modal) {
        modal.classList.remove('hidden');
        modal.classList.add('flex');
    }
}

// 隐藏取消模态框
function hideCancelModal() {
    const modal = document.getElementById('cancel-modal');
    if (modal) {
        modal.classList.add('hidden');
        modal.classList.remove('flex');
    }
}

// 确认取消
function confirmCancel() {
    hideCancelModal();
    clearInterval(countdownTimer);
    alert('订单已取消');
    showPage('orders');
}

// 点击模态框背景关闭
document.addEventListener('click', function(e) {
    const paymentModal = document.getElementById('payment-modal');
    const cancelModal = document.getElementById('cancel-modal');
    
    if (e.target === paymentModal) {
        hidePaymentModal();
    }
    if (e.target === cancelModal) {
        hideCancelModal();
    }
});

// 页面初始化
document.addEventListener('DOMContentLoaded', function() {
    console.log('待支付详情页面已加载');
    startCountdown();
    selectPayment('wechat'); // 默认选择微信支付
});

// 页面显示时重新开始倒计时
function initUnpaidDetail() {
    startCountdown();
    selectPayment('wechat');
}
</script>